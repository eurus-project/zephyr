/dts-v1/;
#include <st/h5/stm32h562.dtsi>
#include <st/h5/stm32h562rgtx-pinctrl.dtsi>
#include <zephyr/dt-bindings/input/input-event-codes.h>
#include <mem.h>

/ {
    model = "WeAct STM32H562 core board";
    compatible = "weact,stm32h562_core";

    chosen {
        zephyr,console = &usart1;
        zephyr,shell-uart = &usart1;
        zephyr,sram = &sram1;
        zephyr,flash = &flash0;
        zephyr,code-partition = &slot0_partition;
    };

    leds: leds {
        compatible = "gpio-leds";
        user_led: led {
            gpios = <&gpiob 2 GPIO_ACTIVE_HIGH>;
            label = "User LED";
        };
    };

    gpio_keys {
        compatible = "gpio-keys";
        user_button: button {
            label = "User";
            gpios = <&gpioc 13 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>;
            zephyr,code = <INPUT_KEY_0>;
        };
    };

    aliases {
        led0 = &user_led;
        sw0 = &user_button;
        volt-sensor0 = &vref;
        volt-sensor1 = &vbat;
    };
};

&usart1 {
	pinctrl-0 = <&usart1_tx_pb14 &usart1_rx_pb15>;
	pinctrl-names = "default";
    status = "okay";
	current-speed = <115200>;
};

&i2c1 {
    pinctrl-0 = <&i2c1_scl_pb6 &i2c1_sda_pb7>;
    pinctrl-names = "default";
    status = "okay";
    clock-frequency = <I2C_BITRATE_FAST>;
};

&spi1 {
    pinctrl-0 = <&spi1_sck_pa5 &spi1_nss_pa4
                 &spi1_miso_pa6 &spi1_mosi_pa7>;
    pinctrl-names = "default";
    status = "okay";
};

&clk_hse {
    clock-frequency = <DT_FREQ_M(8)>;
    status = "okay";
};

&clk_hsi48 {
    status = "okay";
};

&clk_lse {
    status = "okay";
};

&clk_lsi {
    status = "okay";
};

&clk_csi {
    status = "okay";
};

&pll {
    div-m = <1>;
    mul-n = <60>;
    div-p = <2>;
    div-q = <2>;
    div-r = <2>;
    clocks = <&clk_hse>;
    status = "okay";
};

&rcc {
    clocks = <&pll>;
    clock-frequency = <DT_FREQ_M(240)>;
    ahb-prescaler = <1>;
    apb1-prescaler = <1>;
    apb2-prescaler = <1>;
    apb3-prescaler = <1>;
};

&gpdma1 {
    status = "okay";
};

&gpdma2 {
    status = "okay";
};

&flash0 {
    reg = <0x08000000 DT_SIZE_M(2)>;
    
    partitions {
        compatible = "fixed-partitions";
        #address-cells = <1>;
        #size-cells = <1>;

        boot_partition: partition@0 {
            label = "mcuboot";
            reg = <0x00000000 DT_SIZE_K(64)>;
        };
        slot0_partition: partition@10000 {
            label = "image-0";
            reg = <0x00010000 DT_SIZE_K(960)>;
        };
        slot1_partition: partition@100000 {
            label = "image-1";
            reg = <0x00100000 DT_SIZE_K(960)>;
        };
        storage_partition: partition@1f0000 {
            label = "storage";
            reg = <0x001f0000 DT_SIZE_K(64)>;
        };
    };
};

zephyr_udc0: &usb {
    pinctrl-0 = <&usb_dm_pa11 &usb_dp_pa12>;
    pinctrl-names = "default";
    status = "okay";
};

&vref {
	status = "okay";
};

&vbat {
	status = "okay";
};
